
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>> pshdo</title>
  <meta name="author" content="Aaron Jensen">

  
  <meta name="description" content="Carbon v1.1 is out. It is backwards-compatible with v1.0. Get the bits at BitBucket. Upgrade Instructions On Windows 2008 R2, custom identies that &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://pshdo.com/6/index.html">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/pshdo.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/archive/atom.xml" rel="alternate" title="> pshdo" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">> pshdo</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/archive/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:pshdo.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
	<li><a href="/about">About</a></li>
	<li><a href="/archive">Archive</a></li>
	<li><a href="/projects">Projects</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/04/carbon-v11-released.html">Carbon v1.1 Released</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-04-01T13:32:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Carbon v1.1 is out. It is <a href="http://semver.org">backwards-compatible</a> with v1.0.  <a href="https://bitbucket.org/splatteredbits/carbon/downloads">Get the bits at BitBucket</a>.</p>

<h2>Upgrade Instructions</h2>

<ul>
<li>On Windows 2008 R2, custom identies that run IIS app pools need the <code>SeBatchLogonRight</code>.  <a href="http://get-carbon.org/help/Install-IisAppPool.html">Install-IisAppPool</a> now grants this privilege on all operating systems.  If this won&rsquo;t work in your environment, you can remove these privileges with <a href="http://get-carbon.org/help/Revoke-Privilege.html">Revoke-Privilege</a>.</li>
</ul>


<h2>Enhancements</h2>

<h3>General</h3>

<ul>
<li>Fixed some typos and ommissions in the v0.5.0.1 and v0.5.0.0 sections of the release notes.</li>
<li>Updated <code>Import-Carbon.ps1</code> script to import Carbon regardless of the name of the directory Carbon is installed in.</li>
</ul>


<h3>Certificates</h3>

<ul>
<li>Added <code>IssuedTo</code> and <code>IssuedBy</code> properties to <a href="http://msdn.microsoft.com/en-us/library/ms148409.aspx">X509Certificate2</a> objects.  The values match what the Certificates MMC snap-in displays.</li>
<li>Added <code>DisplayName</code> property to <a href="http://msdn.microsoft.com/en-us/library/d228271e.aspx">X509Store</a> objects, to show the names of the stores as they are displayed in the Certificates MMC snap-in.</li>
</ul>


<h3>Computer</h3>

<ul>
<li>Created <a href="http://get-carbon.org/help/Resolve-NetPath.html">Resolve-NetPath</a> for getting the path to the Windows <code>net.exe</code> command/application.  Updated all functions that call <code>net.exe</code> to use this function to resolve its path.  Thanks to Paul Aage Aasheim for discovering that when running login scripts, <code>net.exe</code> isn&rsquo;t in the path.</li>
</ul>


<h3>IIS</h3>

<ul>
<li>Created <a href="http://get-carbon.org/help/Get-IisHttpHeader.html">Get-IisHttpHeader</a> for getting the custom HTTP headers for a website or one of its sub-directories.</li>
<li>Created <a href="http://get-carbon.org/help/Set-IisHttpHeader.html">Set-IisHttpHeader</a> for creating/setting a custom HTTP header for a website or one of its sub-directories.</li>
<li>Created <a href="http://get-carbon.org/help/Get-IisMimeMap.html">Get-IisMimeMap</a> for getting the file extension to MIME type mappings for the IIS web server.</li>
<li>Created <a href="http://get-carbon.org/help/Remove-IisMimeMap.html">Remove-IisMimeMap</a> for removing a file extension to MIME type mapping for the IIS web server.</li>
<li>Created <a href="http://get-carbon.org/help/Set-IisMimeMap.html">Set-IisMimeMap</a> for creating/setting a file extension to MIME type mapping for the IIS web server.</li>
<li>When creating an app pool that runs under a custom, non-service account, <a href="http://get-carbon.org/help/Install-IisAppPool.html">Install-IisAppPool</a> grants that user the <code>SeBatchLogonRight</code>.</li>
<li><a href="http://get-carbon.org/help/Install-IisAppPool.html">Install-IisAppPool</a> writes an error if its user account doesn&rsquo;t exist (i.e. if the value of the <code>Username</code> parameter doesn&rsquo;t exist).</li>
</ul>


<h3>Privileges</h3>

<ul>
<li>Improved exception handling in <a href="http://get-carbon.org/help/Grant-Privilege.html">Grant-Privilege</a> and <a href="http://get-carbon.org/help/Revoke-Privilege.html">Revoke-Privilege</a>.</li>
<li><a href="http://get-carbon.org/help/Grant-Privilege.html">Grant-Privilege</a> and <a href="http://get-carbon.org/help/Revoke-Privilege.html">Revoke-Privilege</a> now write an error message if an identity doesn&rsquo;t exist.</li>
</ul>


<h2>Bug Fixes</h2>

<h3>Computer</h3>

<ul>
<li><a href="http://get-carbon.org/help/Install-SmbShare.html">Install-SmbShare</a> can&rsquo;t find <code>net.exe</code> when running as part of a Windows logon script.  Thanks to Paul Aage Aasheim for identifying and reporting this bug.  All usages of the <code>net.exe</code> application were updated to use the new <a href="http://get-carbon.org/help/Resolve-NetPath.html">Resolve-NetPath</a> function, which get the path to <code>net.exe</code> without assuming it is in the user&rsquo;s <code>PATH</code> environment variable.</li>
</ul>


<h3>Users and Groups</h3>

<ul>
<li><a href="http://get-carbon.org/help/Test-Identity.html">Test-Identity</a> no longer writes an error if it can&rsquo;t find a fully-qualified local user, e.g. <code>$env:COMPUTERNAME\Username</code>.</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/03/stupid-feed-tricks.html">Stupid Feed Tricks</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-03-29T03:58:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://inessential.com/2013/03/18/brians_stupid_feed_tricks">Brent Simmons, who goes on to quote Brian Reischl:</a></p>

<blockquote><p>At NewsGator and Sepia Labs I worked with Brian Reischl, one of the server-side guys. Among other things, he worked on NewsGator’s RSS content service, which reads n million feeds once an hour.</p>

<p>(I don’t know if I can say what n is. It surprised me when I heard it. The system is still running, by the way.)</p>

<p>Brian is intimately acquainted with the different ways feeds can be screwed up. So he posted <a href="https://docs.google.com/document/d/1cvq67iQpk2C7ufOsefsfKnGCXeUIv46NQHbnHkm8PtU/edit?usp=sharing">Stupid Feed Tricks</a> on Google Docs.</p>

<p>I quote the entire thing below for people like me who don’t have Google accounts. The below is all by Brian:</p></blockquote>

<p>He then goes on to list several dozen edge cases the feed reader had to handle.</p>

<p><strong>Writing software is hard.</strong></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/03/powershell-check-if-processes-are-waiting-and-prompting-for.html">PowerShell: Check if Processes Are Waiting and Prompting for User Input</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-03-25T13:13:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&rsquo;m currently writing a PowerShell script that will commit changes to a <a href="http://mercurial.selenic.com">Mercurial</a> repository, then push those changes out to our central Mercurial server.  If there are new changes on the server, the script will need to pull those changes down before it pushes, merge them, commit the merge, then re-push to the server.  Rinse and repeat until the push succeeds.  Because it will run under our continuous integration build server, it needs to be able to run headless (i.e., non-interactively).</p>

<p>During a merge, Mercurial will sometimes prompt the user for input (e.g. if a file was deleted by someone, but modified by someone else, Mercurial asks if you want to keep the change or keep the deletion).  Prompting for input won&rsquo;t work under a continuous integration server because no one&rsquo;s around to answer.  So, my script needs to detect when Mercurial is prompting for input, kill it, then notify those responsible that manual intervention is necessary.</p>

<p>Google turned up <em><a href="http://stackoverflow.com/questions/1704791/is-my-process-waiting-for-input">Is My Process Waiting for Input?</a></em> on StackOverflow.  The .NET <a href="http://msdn.microsoft.com/en-us/library/system.diagnostics.process.aspx">System.Net.Diagnostics.Process</a> class has a <a href="http://msdn.microsoft.com/en-us/library/system.diagnostics.process.threads.aspx">Threads</a> property, which is a collection of <a href="http://msdn.microsoft.com/en-us/library/system.diagnostics.processthread.aspx">ProcessThread</a> objects.  If a process is waiting for input, one of its threads will be in a wait state (i.e. its <a href="http://msdn.microsoft.com/en-us/library/system.diagnostics.processthread.threadstate.aspx">ThreadState</a> property will be <code>Wait</code>), waiting for user input (i.e., its <a href="http://msdn.microsoft.com/en-us/library/system.diagnostics.processthread.waitreason.aspx">WaitReason</a> property will be <code>LpcReply</code>).</p>

<p>So, to get all process in PowerShell that are waiting for user input, you can do something like this:</p>

<pre><code>Get-Process | Where-Object { 
    Select-Object -ExpandProperty Threads | 
        Where-Object { $_.ThreadState -eq 'Wait' -and $_.WaitReason -eq 'LpcReply' }
}
</code></pre>

<p>Of course, this is the easy part.  Here&rsquo;s my final script.  In addition to using <code>Start-Process</code> to start the merge so we can monitor the process while its running, it redirects STDOUT and STDERR to files, so we can see it in our build log.</p>

<pre><code># Create some files for storing STDOUT and STDERR streams
$randomFileName = [IO.Path]::GetRandomFileName()

$stdOutFile = 'hg.merge.StdOut.{0}' -f $randomFileName
$stdOutFile = Join-Path $env:Temp $stdOutFile

$stdErrFile = 'hg.merge.StdErr.{0}' -f $randomFileName
$stdErrFile = Join-Path $env:Temp $stdErrFile

# Start the merge.
$mergeProcess = Start-Process -FilePath hg.exe `
                              -ArgumentList 'merge','-r',$Revision `
                              -PassThru `
                              -NoNewWindow `
                              -RedirectStandardOutput $stdOutFile `
                              -RedirectStandardError $stdErrFile
try
{
    do
    {
        # If the merge every prompts the user for input, kill it.
        Start-Sleep -Milliseconds 100
        $waitingForInput = $mergeProcess.Threads | 
                                Where-Object { $_.ThreadState -eq 'Wait' -and $_.WaitReason -eq 'LpcReply' }
        if( $waitingForInput )
        {
            Write-Error -Message ('Stopping non-interactive merge: Mercurial is prompting for input.') `
                        -RecommendedAction 'Please merge manually.'
            $null = $mergeProcess | Stop-Process -PassThru | Wait-Process
            break
        }
    }
    while( -not $mergeProcess.HasExited )

    # Display STDOUT.
    Get-Content -Path $stdOutFile | Write-Host

    # Display STDERR
    # For some reason, it takes a little time to read the Standard Error file.
    $errors = $null
    $readFile = $false
    do
    {
        Start-Sleep -Milliseconds 100
        try
        {
            $errors = [IO.File]::ReadAllText($stdErrFile)
            $readFile = $true
        }
        catch
        {
        }
    }
    while( -not $readFile )

    if( $errors )
    {
        Write-Error -Message $errors
    }

}
finally
{
    # Clean up the temporary files used to capture STDOUT and STDERR
    ($stdOutFile,$stdErrFile) | Where-Object { Test-Path -Path $_ -PathType Leaf } | Remove-Item
}
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/03/monitoring-windows-process-start-and-exit-events.html">Monitoring Windows Process Start and Exit Events</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-03-18T14:14:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Part of my build server management responsibilities include trying to figure out why things are going wrong.  I don&rsquo;t know about other environments, but our builds run a lot of processes. For example, we use <a href="http://technet.microsoft.com/en-us/library/cc733145.aspx">Robocopy</a> to individually deploy a website&rsquo;s sub-directories.  When things go wrong, it&rsquo;s hard to debug because these robocopy processes start and stop so quickly, I don&rsquo;t have time to double-click them in <a href="http://technet.microsoft.com/en-us/sysinternals/bb896653">Process Explorer</a>. I usually resorted to adding lines in our deployment script to output the Robocopy command line and exit code, then running the build, waiting for it to finish, then inspecting the build logs.</p>

<p><em>Ugh.</em></p>

<p>Last week, I discovered that <a href="http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx">Process Monitor</a> captures process start and exit events.  Just the information I need in these situations.</p>

<p>Open Process Monitor, and click the &ldquo;Filter&rdquo; button.</p>

<p><img src="/storage/screenshots/procmon/ProcessMonitorFilterButton.png" alt=""/></p>

<p>Create a new condition that matches when the <code>Operation</code> column contains the word <code>process</code> (don&rsquo;t forget to click the <code>Add</code> button).</p>

<p><img src="/storage/screenshots/procmon/ProcessMonitorFilterOperationContainsProcess.png" alt=""/></p>

<p>Click OK and Process Monitor will start to show process start and exit events. Start events will show the parent process ID and command line used to start the program. Exit events will show the exit/return code and CPU/memory statistics.</p>

<p><img src="/storage/screenshots/procmon/ProcessMonitorProcessStartExitEvents.png" alt=""/></p>

<p> If you double-click the start event, you&rsquo;ll be able to see the entire command line and all the process&rsquo;s environment variables.</p>

<p>Thanks to the <a href="http://technet.microsoft.com/en-us/sysinternals/bb545021.aspx">Windows Sysinternals team</a> for the great tools.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/03/getting-x509certificate2s-issued-from-and-issued-to-properti.html">Getting X509Certificate2's "Issued From" and "Issued to" Properties in PowerShell</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-03-14T14:36:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>One of my problems with the <a href="http://msdn.microsoft.com/en-us/library/ms148409.aspx">X509Certificate2</a> object is that it doesn&rsquo;t expose properties for the &ldquo;Issued From&rdquo; and &ldquo;Issued To&rdquo; data, properties which show by default when viewing certificates in the Windows Certificate MMC snap-in. This makes it difficult to match certificates you see the Certificates MMC with certificates you see in PowerShell.</p>

<p>Today I <a href="http://social.msdn.microsoft.com/Forums/en-US/csharpgeneral/thread/a74e3465-7e36-43a9-a83a-fb28a629218f">discovered</a> the <a href="http://msdn.microsoft.com/en-us/library/system.security.cryptography.x509certificates.x509certificate2.getnameinfo.aspx">GetNameInfo method</a>, which can return the &ldquo;Issued To/By&rdquo; text seen in the Certificates MMC snap-in:</p>

<pre><code>Get-ChildItem cert:\CurrentUser\My |
    Format-Table @{ Label = 'IssuedTo'; Expression = { $_.GetNameInfo( 'SimpleName', $false ) } },@{ Label = 'IssuedBy' ;Expression = { $_.GetNameInfo( 'SimpleName', $true ) } }
</code></pre>

<p>Here it is a little clearer:</p>

<pre><code>$cert.GetNameInfo( 'SimpleName', $false ) # This is IssuedTo.
$cert.GetNameInfo( 'SimpleName', $true )  # This is IssuedBy.
</code></pre>

<p>You could also pipe your certificates to <a href="http://technet.microsoft.com/en-us/library/hh849879.aspx">Add-Member</a>:</p>

<pre><code>Get-ChildItem cert:\CurrentUser\My |
    Add-Member ScriptProperty -Name IssuedTo -Value { $this.GetNameInfo( 'SimpleName', $false) } -PassThru |
    Add-Member ScriptProperty -Name IssuedBy -Value { $this.GetNameInfo( 'SimpleName', $true ) } -PassThru |
    Format-Table -Property IssuedTo,IssuedBy -AutoSize
</code></pre>

<p>The next version of <a href="http://get-carbon.org">Carbon</a> will add <code>IssuedBy</code> and <code>IssuedTo</code> properties to <code>X509Certificate2</code> objects, so you can do this instead:</p>

<pre><code>Get-ChildItem cert:\CurrentUser\My |
    Format-Table IssuedTo,IssuedBy -AutoSize
</code></pre>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="7">&larr; Olderfsdfsdfsdaf</a>
    
    <a href="/archive">Archive</a>
    
    <a class="next" href="5">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2018/06/carbon-2.5.4-released.html">Carbon 2.5.4 Released</a>
      </li>
    
      <li class="post">
        <a href="/2017/06/carbon-2.5.0-released.html">Carbon 2.5.0 Released</a>
      </li>
    
      <li class="post">
        <a href="/2017/04/libgit2-0.3.2-released.html">LibGit2 0.3.2 Released</a>
      </li>
    
      <li class="post">
        <a href="/2017/02/carbon-2.4.1-released.html">Carbon 2.4.1 Released</a>
      </li>
    
      <li class="post">
        <a href="/2016/11/carbon-2.4.0-released.html">Carbon 2.4.0 Released</a>
      </li>
    
      <li class="post">
        <a href="/2016/09/carbon-2.3.0-released.html">Carbon 2.3.0 Released</a>
      </li>
    
      <li class="post">
        <a href="/2016/05/carbon-2.2.0-released.html">Carbon 2.2.0 Released</a>
      </li>
    
      <li class="post">
        <a href="/2016/02/carbon-2.1.1-released.html">Carbon 2.1.1 Released</a>
      </li>
    
      <li class="post">
        <a href="/2016/02/carbon-2.1.0-released.html">Carbon 2.1.0 Released</a>
      </li>
    
      <li class="post">
        <a href="/2015/10/carbon-2.0.1-released.html">Carbon 2.0.1 Released</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2018 - Aaron Jensen -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
