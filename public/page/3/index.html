
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>> pshdo</title>
  <meta name="author" content="Aaron Jensen">

  
  <meta name="description" content="I&rsquo;ve released Carbon v0.2.3. Download it from BitBucket. It&rsquo;s mostly documentation updates, but I snuck a couple of bug fixes in there. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://pshdo.com/page/3/index.html">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/pshdo.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/archive/atom.xml" rel="alternate" title="> pshdo" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">> pshdo</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/archive/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:pshdo.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
	<li><a href="/about">About</a></li>
	<li><a href="/archive">Archive</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/archive/2012/6/27/carbon-v023-released.html">Carbon v0.2.3 Released</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-27T09:56:00-07:00" pubdate data-updated="true">Jun 27<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&rsquo;ve released Carbon v0.2.3. <a href="https://bitbucket.org/splatteredbits/carbon/downloads">Download it from BitBucket.</a>  It&rsquo;s mostly documentation updates, but I snuck a couple of bug fixes in there.</p>

<h2 id="enhancements">Enhancements</h2>

<p>Improved documentation for:</p>

<ul>
  <li><a href="http://get-carbon.org/help/Disable-IEEnhancedSecurityConfiguration.html">Disable-IEEnhancedSecurityConfiguration</a></li>
  <li><a href="http://get-carbon.org/help/Enable-IEActivationPermissions.html">Enable-IEActivationPermissions</a></li>
  <li><a href="http://get-carbon.org/help/Disable-IEEnhancedSecurityConfiguration.html">Get-FullPath</a></li>
  <li><a href="http://get-carbon.org/help/Invoke-WindowsInstaller.html">Invoke-WindowsInstaller</a></li>
  <li><a href="http://get-carbon.org/help/Protect-String.html">Protect-String</a></li>
  <li><a href="http://get-carbon.org/help/Remove-EnvironmentVariable.html">Remove-EnvironmentVariable</a></li>
  <li><a href="http://get-carbon.org/help/Set-DotNetAppSetting.html">Set-DotNetAppSetting</a></li>
  <li><a href="http://get-carbon.org/help/Set-DotNetConnectionString.html">Set-DotNetConnectionString</a></li>
  <li><a href="http://get-carbon.org/help/Set-EnvironmentVariable.html">Set-EnvironmentVariable</a></li>
  <li><a href="http://get-carbon.org/help/Test-OSIs32Bit.html">Test-OSIs32Bit</a></li>
  <li><a href="http://get-carbon.org/help/Test-OSIs64Bit.html">Test-OSIs64Bit</a></li>
  <li><a href="http://get-carbon.org/help/Unprotect-String.html">Unprotect-String</a></li>
</ul>

<h2 id="bug-fixes">Bug fixes</h2>
<ul>
  <li><a href="http://get-carbon.org/help/Invoke-WindowsInstaller.html">Invoke-WindowsInstaller</a> doesn&rsquo;t validate that installer path ends in &lsquo;.msi&rsquo;.</li>
  <li><a href="http://get-carbon.org/help/Invoke-WindowsInstaller.html">Invoke-WindowsInstaller</a> not showing correct exit code when installation fails.</li>
</ul>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/archive/2012/6/19/carbon-v022-released.html">Carbon v0.2.2 Released</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-19T17:28:00-07:00" pubdate data-updated="true">Jun 19<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&rsquo;ve released Carbon v0.2.2.  <a href="https://bitbucket.org/splatteredbits/carbon/downloads">Download it from BitBucket.</a>  There were a bunch of documentation improvements, along with the following:</p>

<h2 id="enhancements">Enhancements</h2>

<ul>
  <li>Created Import-Carbon script to help users properly import Carbon.</li>
</ul>

<h2 id="bug-fixes">Bug fixes</h2>

<ul>
  <li>Add-GroupMembers fails to add Administrators and ANONYMOUS LOGON built-in accounts.</li>
  <li>Add-GroupMembers fails when adding built-in accounts multiple times.</li>
  <li>Add-GroupMembers fails to add domain user to a local group.</li>
</ul>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/archive/2012/6/4/best-practices-for-importing-powershell-modules.html">Best Practices for Importing PowerShell Modules</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-04T14:59:00-07:00" pubdate data-updated="true">Jun 4<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2 id="importing-modules-is-messy">Importing Modules Is Messy</h2>

<p>An error users encounter with <a href="http://get-carbon.org">Carbon</a> is double-importing its extended type data file.  If Carbon has been imported in another module (i.e. Carbon is a sub-module of that module), when you use <code>Import-Module</code> to import Carbon, PowerShell will sometimes complain about not being able to load Carbon&rsquo;s extended data file:</p>

<pre><code>&gt; Import-Module SubModuleWhichImportsCarbon
&gt; Import-Module Carbon
Import-Module : The following error occurred while loading the extended type data file:
Microsoft.PowerShell, Carbon.types.ps1xml : File skipped because it was already present from "Microsoft.PowerShell".
</code></pre>

<p>I&rsquo;ve tried a bunch of things to mitigate this error.  I&rsquo;ve always just wanted to import Carbon with one line of code:</p>

<pre><code>Import-Module Carbon
</code></pre>

<p>At first, I tried using the <code>-Force</code> parameter to <code>Import-Module</code>, but that didn&rsquo;t work.  Then I tried removing Carbon if it was present before importing it again:</p>

<pre><code>if( (Get-Module Carbon) )
{
	Remove-Module Carbon
}
Import-Module Carbon
</code></pre>

<p>Unfortunately, the above code doesn&rsquo;t work when Carbon is a sub-module because <code>Get-Module</code> doesn&rsquo;t return sub-modules.  </p>

<p>Next, I updated all my modules that imported Carbon to check for and remove any stand-alone Carbon modules before importing Carbon.  I basically added the code above to all the modules that used Carbon.  This approach worked most of the time, but there were still weird edge cases that caused the double-import error.  The only solution left, I thought, was to re-write all my scripts to add additional code to detect a Carbon sub-module.  That&rsquo;s a lot of scripts to update and a lot of duplicate code between scripts.</p>

<h2 id="the-solution">The Solution</h2>

<p>Looking back, I can see that my brain was stuck in the rut of trying to solve the problem in each of my scripts using as few lines as possible.  It hit me the other day that I should write an <code>Import-Carbon.ps1</code> script which properly handles all the weird edge cases. With this script in place, I could update all my scripts that use Carbon to call <code>Import-Carbon.ps1</code> to do the import.</p>

<pre><code>$PSScriptRoot = Split-Path -Parent $MyInvocation.MyCommand.Definition
&amp; (Join-Path $PSScriptRoot Tools\Carbon\Import-Carbon.ps1 -Resolve)
</code></pre>

<p>Finally!  One line of code to import a module.  And, only one place to change if additional weird edge cases pop up.</p>

<h2 id="sub-module-detection">Sub-module Detection</h2>

<p>Now, I just had to write code to detect a Carbon sub-module.  The best way to do this is to check for the presence of a variable or function specific to a module.  In this case, I use the <code>$CarbonImported</code> variable, which I added to Carbon for just this purpose:</p>

<pre><code>if( (Get-Module Carbon) )
{
    Remove-Module Carbon
}
elseif( Test-Path "variable:CarbonImported" )
{
    $var = Get-Variable 'CarbonImported'
    $varModule = Get-Module $var.Module
    Write-Warning ("Carbon already present as nested module in {0} module ({1})." -f $var.Module, $varModule.ModuleBase)    
    return
}

Import-Module Carbon
</code></pre>

<p>If Carbon is present as a sub-module, I write out a warning and return without attempting a re-import.  </p>

<h2 id="therefore-what">Therefore, What?</h2>

<p>When writing a module, <strong>always write and include a script that safely imports the module</strong>.  I recommend using the above code as a template.  If you&rsquo;re using a module that doesn&rsquo;t include a safe import scrpt, write one yourself.  Test for a variable or function that is specific to the module.  (That&rsquo;s not fool-proof, however.  Users can always import individual functions and variables from your module.  In that case, the function/variable you&rsquo;re detecting may not have been imported, and the detection will fail.)  </p>

<p><strong>Don&rsquo;t</strong> detect the presence of your assemblies or types.  They remain loaded even if your module has been removed.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/archive/2012/5/30/online-carbon-help.html">Online Carbon Help</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-30T12:11:00-07:00" pubdate data-updated="true">May 30<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The current version of the <a href="http://get-carbon.org">Carbon</a> help is now <a href="http://get-carbon.org/help/">online</a>.  There are still a lot of functions that have little to no documentation.  Now that I&rsquo;ve put it online, and have automated scripts that will generate it for me, I&rsquo;ll be steadily improving the documentation.  It&rsquo;s my number one priority before I release version 1.0.</p>

<p>I&rsquo;m using a heavily-modified version of <a href="http://poshcode.org/587">Out-Html</a> to <a href="https://bitbucket.org/splatteredbits/carbon/src/tip/Out-Html.ps1">convert the built-in help to HTML</a>.  All the description and example explanations in the help are written using <a href="http://daringfireball.net/projects/markdown">Markdown</a>, and I&rsquo;m using <a href="http://code.google.com/p/markdownsharp/">MarkdownSharp</a> to convert to HTML.</p>

<p>The only outstanding improvement I&rsquo;d like to make to the online help is to create links from type names to their MSDN documentation.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/archive/2012/5/4/beware-get-childitem.html">Beware Get-ChildItem</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-04T16:05:00-07:00" pubdate data-updated="true">May 4<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I discovered today that the <code>Get-ChildItem</code> cmdlet wasn&rsquo;t behaving as I expected.  Passing it <code>$null</code>, <code>@()</code>, or <code>''</code> will return the contents of the current directory:</p>

<pre><code>&gt; Get-ChildItem .


   Directory: C:\Temp\BewareGetChildItem

Mode                LastWriteTime     Length Name
----                -------------     ------ ----
-a---          5/4/2012   4:08 PM          6 Get-ChildItem.txt


&gt; Get-ChildItem $null


   Directory: C:\Temp\BewareGetChildItem

Mode                LastWriteTime     Length Name
----                -------------     ------ ----
-a---          5/4/2012   4:08 PM          6 Get-ChildItem.txt


&gt; Get-ChildItem @()


   Directory: C:\Temp\BewareGetChildItem

Mode                LastWriteTime     Length Name
----                -------------     ------ ----
-a---          5/4/2012   4:08 PM          6 Get-ChildItem.txt


&gt; Get-ChildItem ''


   Directory: C:\Temp\BewareGetChildItem

Mode                LastWriteTime     Length Name
----                -------------     ------ ----
-a---          5/4/2012   4:08 PM          6 Get-ChildItem.txt
</code></pre>

<p>Yikes!  I would expect it to write an error or just return nothing.</p>

<p>We have a function in our website deployment script that takes in a list of items and a filter, and deletes any item that doesn&rsquo;t match the filter, like this:</p>

<pre><code>function Remove-ExtraFiles($Items, $Exclude)
{
    Get-ChildItem $Items -Exclude $Exclude -Recurse |
        Where-Object { -not $_.PsIsContainer } |
        Remove-Item
}
</code></pre>

<p>I was testing this script when I saw that files under my local directory were getting deleted.  By the time I killed the script, it was too late: the last two hours of work were gone.  It turns out that <code>Remove-ExtraFiles</code> was getting called with an empty array as the <code>$Items</code> parameter value.</p>

<p>In my case, the solution was to add some validation to the <code>$Items</code> parameter:</p>

<pre><code>function Remove-ExtraFiles
{
    param(
        [Parameter(Mandatory=$true)]
        [string[]]
        $Items,
        
        [string[]]
        $Exclude)
    )
    Get-ChildItem $Items -Exclude $Exclude -Recurse |
        Where-Object { -not $_.PsIsContainer } |
        Remove-Item
}
</code></pre>

<p>Making the parameter mandatory causes a script error if calling <code>Remove-ExtraFiles</code> with null, an empty array, or an empty string.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/archive/2012/4/30/new-website.html">New-Website</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-30T22:24:00-07:00" pubdate data-updated="true">Apr 30<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In Feburary 2011, I finally got tired of using MSBuild as a scripting language.  There are great frameworks out there that make it bearable, but trying to use a build language to script and program is a recipe for disaster and bloated scripts. </p>

<p>I don&rsquo;t know what finally motivated me to learn PowerShell.  I ordered every PowerShell book from the library, but returned them as soon as I started Lee Holmes&rsquo; <a href="http://shop.oreilly.com/product/9780596528492.do">PowerShell Cookbook</a>. Within a few days, I was writing scripts.  A year later, I have a hard time writing MSBuild.</p>

<p>I&rsquo;m still kicking myself for waiting as long as I did.  I had heard lots of respectable developers extol PowerShell, but I never set aside the time to learn it.  What a waste.</p>

<p>If you&rsquo;re a .NET developer, and still using cmd as your command prompt, or even worse cygwin (shudder), shame on you!  Take a deep breath, two days off, and read Lee Holmes&rsquo; book.  You&rsquo;ll never look back.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/archive">Archive</a>
    
    <a class="next" href="/page/2/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section style="margin-top:2em;">

	<p>
		<a href="http://twitter.com/pshdo"><img src="/storage/twitter.png" alt="" width="32" height="32" style="border:none;vertical-align:middle;" ></a>
		
		<a href="http://twitter.com/pshdo" >Follow on Twitter</a>
	</p>

</section><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2013/06/desired-state-configuration-with-powershell.html">Desired State Configuration With PowerShell</a>
      </li>
    
      <li class="post">
        <a href="/archive/2013/4/25/who-is-modifying-that-file.html">Who Is Modifying That File?</a>
      </li>
    
      <li class="post">
        <a href="/archive/2013/4/25/serilog.html">Serilog</a>
      </li>
    
      <li class="post">
        <a href="/archive/2013/4/1/carbon-v11-released.html">Carbon v1.1 Released</a>
      </li>
    
      <li class="post">
        <a href="/archive/2013/3/29/stupid-feed-tricks.html">Stupid Feed Tricks</a>
      </li>
    
  </ul>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Aaron Jensen -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
